# Apache Shiro 认证绕过漏洞（CVE-2020-1957）复现

Apache Shiro是一款开源安全框架，提供身份验证、授权、密码学和会话管理。Shiro框架直观、易用，同时也能提供健壮的安全性。

CVE-2020-1957，Spring Boot中使用Apache  Shiro进行身份验证、权限控制时，可以精心构造恶意的URL，***利用Apache Shiro和Spring  Boot对URL的处理的差异化***，可以绕过Apache Shiro对Spring Boot中的Servlet的权限控制，越权并实现未授权访问。

Shiro的URL路径表达式为Ant格式，路径通配符表示匹配零个或多个字符串，/可以匹配/hello，但是匹配不到/hello/，因为*通配符无法匹配路径。加入/hello接口设置了authc拦截器，访问/hello会进行权限判断，但如果访问的是/hello/那么将无法正确匹配URL，直接放行，进入到spring拦截器。spring中的/hello和/hello/形式的URL访问的资源是一样的，从而实现权限绕过。

### 漏洞影响

Apache Shiro版本<1.5.2

### 环境搭建

执行如下命令启动一个搭载Spring 2.2.2与Shiro 1.5.1的应用：

`cd vulhub/shiro/CVE-2020-1957`

`docker compose up -d`

环境启动后，访问`http://x.x.x.x:8080`即可查看首页:

![image-20250315113254568](C:\Users\21415\AppData\Roaming\Typora\typora-user-images\image-20250315113254568.png)

### 漏洞复现

bp抓包，发现回显302并跳转登录

![image-20250315113616994](C:\Users\21415\AppData\Roaming\Typora\typora-user-images\image-20250315113616994.png)

![image-20250315113635483](C:\Users\21415\AppData\Roaming\Typora\typora-user-images\image-20250315113635483.png)

构造恶意请求/x/..;/admin/，成功绕过登录进入，实现未授权访问

![image-20250315113848489](C:\Users\21415\AppData\Roaming\Typora\typora-user-images\image-20250315113848489.png)

- 客户端请求URL: `/xxx/..;/admin/`
- Shrio 内部处理得到校验URL为 `/xxxx/..`,校验通过
- SpringBoot 处理 `/xxx/..;/admin/` , 最终请求 `/admin/`, 成功访问了后台请求。

### 参考链接

* https://xz.aliyun.com/news/7876?time__1311=Yqjx0DuDgiuDlOzG7DyDAO7QDCQu4i3x&u_atoken=57b64b28d7ad62fb6634e98a4f6349f7&u_asig=1a0c381017420080127592451e008d
* https://blog.spoock.com/2020/05/09/cve-2020-1957/
* https://github.com/vulhub/vulhub/blob/master/shiro/CVE-2020-1957/README.zh-cn.md







